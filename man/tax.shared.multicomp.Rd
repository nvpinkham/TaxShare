% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Functions.2026.01.22.R
\name{tax.shared.multicomp}
\alias{tax.shared.multicomp}
\title{Shared Taxa Multi-Comparison Barplot}
\usage{
tax.shared.multicomp(
  otu.input,
  var1,
  var2,
  var1.groups,
  var2.groups,
  tax.level,
  taxa2include,
  family.name.length = 3,
  var1.color1 = "orange",
  var1.color2 = "purple",
  PresAbs = F,
  log = T,
  min.obs = 1,
  fdr = T,
  summary.fun = mean
)
}
\arguments{
\item{otu.input}{A numeric matrix or data frame of OTU/ASV counts.
Rows correspond to samples and columns correspond to taxa.}

\item{var1}{A factor or vector defining the primary comparison variable.
MUST contain exactly TWO levels within each var2 subset.}

\item{var2}{A factor or vector defining the stratification variable.
Comparisons are performed separately for each unique value.}

\item{var1.groups}{Optional character vector of levels to be includded}

\item{var2.groups}{Optional character vector specifying the levels of var2
to iterate over.}

\item{tax.level}{A character vector assigning each taxon to a taxonomic
level (e.g., family, genus). Length must match number of taxa.}

\item{taxa2include}{Optional character vector specifying which taxa
to include. Defaults to all taxa present in \code{tax.level}.}

\item{family.name.length}{Integer controlling how taxon names are truncated
or simplified for plotting.
\describe{
\item{1}{Use first taxonomic component only}
\item{2}{Trim secondary delimiters}
\item{3}{Remove delimiters but retain full name (default)}
}}

\item{var1.color1}{Colors for group 1 of var1.
May be a single color or a vector matching number of samples.}

\item{var1.color2}{Color for group 2 of var1.
May be a single color or a vector matching number of samples.}

\item{PresAbs}{Logical; if TRUE, convert counts to presence/absence
before summarization.}

\item{log}{Logical; if TRUE (default), log10-transform values
after adding a pseudocount of 1.}

\item{min.obs}{Integer specifying the minimum number of observations
required for a taxon to be included.}

\item{fdr}{Logical; if TRUE, apply false discovery rate correction
in the underlying taxonomic comparison.}

\item{summary.fun}{Function used to summarize taxa abundance
(default is \code{mean}).}
}
\value{
A named list of matrices, one per \code{var2} group.
Each matrix contains summarized taxon abundances used for plotting.
The function is called for its side effect (plotting), but the
underlying data are returned invisibly for downstream use.
}
\description{
Performs repeated two-group taxonomic comparisons across multiple levels
of a second grouping variable and visualizes shared and unique taxa
using stacked horizontal barplots.
}
\details{
For each level of var2, the function subsets the OTU table and
compares exactly two groups defined by var1. Taxa are summarized
at a specified taxonomic level, optionally transformed, and plotted
with color-coding that highlights taxa unique to each group as well as
taxa shared between groups.

This function is intended for exploratory visualization of taxonomic
overlap across experimental strata (e.g., sites, time points, host classes).

The function internally calls \code{tax.shared.table()} to compute
shared and unique taxa between two groups. Taxa are visualized as
stacked horizontal bars, with color gradients indicating shared taxa.

Log scaling is applied post-summarization and affects both bar lengths
and reference scale annotations.

Groups within \code{var2} that do not contain exactly two \code{var1}
levels are skipped with a warning.
}
\examples{
\dontrun{
tax.shared.multicomp(
  otu.input = otu_table,
  var1 = treatment,
  var2 = site,
  var1.groups = c("Control", "Treatment"),
  var2.groups = c("A", "B", "C"),
  tax.level = taxonomy$Family
)
}

}
\seealso{
\code{\link{tax.shared.table}}
}
